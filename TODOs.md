# TODOs

## current task

```log
```

## roots

* return title, description, publication, record types, count of number of records

## client libs from swagger

* Add code samples to OpenAPI spec generated by FAST-API <https://github.com/fastapi/fastapi/discussions/8946>
  * depends on having a directory of code samples

* java: <https://swagger.io/docs/open-source-tools/swagger-codegen/>
* npm

```text
Step 3: Generate Client Library

Use openapi-generator-cli to generate client libraries from your OpenAPI specification. This simplifies interacting with your API from various programming languages.

openapi-generator-cli generate -i path-to-your-openapi-spec.yaml -g javascript -o /path-to-output-director
```

## page queries that take a `track` query parameter

* pagination when too many ids get passed to `/metadata?track=` or `/data?track=`

## Caching

* internal cache key: from request (endpoing & alphabetized parameters)
* external cache key (view endpoints): request_id + `_view_data_element` and `namespace` = `view`

## FILER API

* add `ResponseType.URL` : IDs, (name?), URL
* add `/filter` endpoint
* pagination for genome browser configs? and counts repsonse
* sorting counts data request
* *URGENT*: if data request and # of tracks is too many (e.g., > 500?), `counts` response format should return the total number of tracks and a message that further filtering is needed

## FILER - Raw

* would a a new FILER endpoint (list of tracks & region -> count of overlaps) speed things up?
* what is an overlap? contained within vs overlap

## ValidationErrors

* should format as follows

```json
{
  "detail": [
    {
      "loc": [
        "string",
        0
      ],
      "msg": "string",
      "type": "string"
    }
  ]
}
```

for example:

```json
{"error":"[{'type': 'enum', 'loc': ('query', 'format'), 'msg': \"Input should be 'json' or 'table'\", 'input': 'bob', 'ctx': {'expected': \"'json' or 'table'\"}}]","msg":"Invalid parameter value"}
```

## FILER Cache DB

* update biosample_term to pull from `original_term` field in track description
* add antibody targets to searchable text during cache build
  > these should be added; need to debug to figure out why the aren't



## session storage / redirects

* look into `fastsession` as it lets you use your memory store
* use memory store / cache instead of session so that we can have multiple windows w/same viz endpoint
* use session to count requests and assign cache keys? maybe
* definitely use for credentials

## Overall great suggestions

* <https://github.com/zhanymkanov/fastapi-best-practices>
* <https://levelup.gitconnected.com/17-useful-middlewares-for-fastapi-that-you-should-know-about-951c2b0869c7>

## Security and Sanitizing

* Very good + rate limiter: <https://escape.tech/blog/how-to-secure-fastapi-api/#validate-and-sanitize-user-input>
* Middleware for `bleaching`: <https://github.com/tiangolo/fastapi/discussions/8354>
* generic for Python APIs: <https://dev.to/mrkanthaliya/validating-and-sanitizing-user-inputs-on-python-projects-rest-api-5a4>

* nh3 for XSS <https://github.com/messense/nh3>

## Custom operators in query parameters

* <https://stackoverflow.com/questions/40618327/how-to-design-generic-filtering-operators-in-the-query-string-of-an-api>

## Error handling & field validation

* <https://stackoverflow.com/a/75545471>
* <https://stackoverflow.com/questions/61392633/how-to-validate-more-than-one-field-of-a-pydantic-model/71258131#71258131>